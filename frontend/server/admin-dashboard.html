<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>总服务器管理平台 - 联邦学习平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f8fafc;
            color: #1e293b;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
            height: 20rem;
            max-height: 320px;
        }
    </style>
</head>
<body class="font-sans">
    <div id="app" class="min-h-screen">
        
        <!-- Header -->
        <header class="bg-white shadow-sm sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center space-x-3">
                        <div id="logoIcon" class="w-8 h-8 bg-gray-600 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path>
                            </svg>
                        </div>
                        <div>
                            <span class="font-bold text-xl text-slate-800">总服务器管理平台</span>
                            <div id="businessBadge" class="text-xs text-slate-500"></div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Navigation -->
                        <nav class="hidden md:flex space-x-1">
                            <button id="nav-dashboard" onclick="navigateTo('dashboard')" 
                                class="px-3 py-2 text-sm rounded-md font-medium bg-purple-100 text-purple-700">
                                仪表盘
                            </button>
                            <button id="nav-clients" onclick="navigateTo('clients')" 
                                class="px-3 py-2 text-sm rounded-md font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-100">
                                客户端管理
                            </button>
                            <button id="nav-models" onclick="navigateTo('models')" 
                                class="px-3 py-2 text-sm rounded-md font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-100">
                                模型管理
                            </button>
                        </nav>
                        <!-- Admin Menu -->
                        <div class="relative">
                            <div class="h-9 w-9 rounded-full bg-purple-200 flex items-center justify-center text-purple-700 font-semibold cursor-pointer" onclick="toggleAdminMenu()">
                                <span id="adminInitial">A</span>
                            </div>
                            <div id="adminMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                                <div class="px-4 py-2 border-b border-slate-200">
                                    <p class="text-sm font-medium text-slate-800" id="adminName">管理员</p>
                                    <p class="text-xs text-slate-500" id="serverAddress">服务器地址</p>
                                </div>
                                <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">退出登录</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main id="page-content" class="p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto">
            <!-- Content will be rendered here -->
        </main>
    </div>

    <!-- Training Request Modal -->
    <div id="training-request-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-6" id="modal-content-request">
        </div>
    </div>

<script>
    // Global state
    const appState = {
        currentPage: 'dashboard',
        userData: null,
        businessType: null,
        clients: [],
        trainingRequests: [],
        globalProjects: [],
        models: []
    };

    let chartInstance = null;

    // Initialize app
    function initializeApp() {
        // Check authentication
        const userData = JSON.parse(localStorage.getItem('userData'));
        if (!userData || userData.userType !== 'server') {
            window.location.href = '../index.html';
            return;
        }

        appState.userData = userData;
        appState.businessType = userData.businessType;

        // Initialize data
        initializeServerData();
        updateHeaderUI();
        renderApp();
    }

    function updateHeaderUI() {
        const { userData, businessType } = appState;
        
        const businessBadge = document.getElementById('businessBadge');
        const adminInitial = document.getElementById('adminInitial');
        const adminName = document.getElementById('adminName');
        const serverAddress = document.getElementById('serverAddress');

        if (businessType === 'ai') {
            businessBadge.textContent = 'AI大模型业务平台';
        } else if (businessType === 'blockchain') {
            businessBadge.textContent = '金融区块链业务平台';
        }

        adminInitial.textContent = userData.adminId.charAt(0).toUpperCase();
        adminName.textContent = userData.adminId;
        serverAddress.textContent = userData.serverAddress;
    }

    function initializeServerData() {
        // Initialize mock data for demo
        if (appState.businessType === 'ai') {
            appState.clients = [
                { id: 1, name: '上海一厂', address: 'http://shanghai.client.com', status: 'online', lastSeen: '2分钟前', projects: 2 },
                { id: 2, name: '武汉二厂', address: 'http://wuhan.client.com', status: 'online', lastSeen: '5分钟前', projects: 1 },
                { id: 3, name: '西安三厂', address: 'http://xian.client.com', status: 'offline', lastSeen: '2小时前', projects: 1 },
                { id: 4, name: '广州四厂', address: 'http://guangzhou.client.com', status: 'online', lastSeen: '1分钟前', projects: 3 }
            ];
            
            appState.trainingRequests = [
                {
                    id: 1,
                    clientName: '上海一厂',
                    projectName: '多工厂视觉缺陷检测联合训练',
                    dataDescription: '包含50万张工业产品图像，涵盖5种常见缺陷类型',
                    trainingPlan: '使用CNN模型，计划100轮训练，期望达到95%准确率',
                    expectedPartners: 3,
                    currentPartners: 1,
                    status: 'pending',
                    requestTime: '2024-01-15 14:30'
                }
            ];

            appState.models = [
                { id: 1, name: 'ResNet-50', type: 'CNN', size: '102MB', version: 'v2.1', downloads: 15 },
                { id: 2, name: 'BERT-Base', type: 'Transformer', size: '440MB', version: 'v1.1', downloads: 8 },
                { id: 3, name: 'YOLOv5', type: 'Detection', size: '28MB', version: 'v6.0', downloads: 23 }
            ];
        } else {
            appState.clients = [
                { id: 1, name: '工商银行', address: 'http://icbc.bank.com', status: 'online', lastSeen: '1分钟前', projects: 2 },
                { id: 2, name: '建设银行', address: 'http://ccb.bank.com', status: 'online', lastSeen: '3分钟前', projects: 1 },
                { id: 3, name: '招商银行', address: 'http://cmb.bank.com', status: 'online', lastSeen: '2分钟前', projects: 1 }
            ];
            
            appState.trainingRequests = [
                {
                    id: 1,
                    clientName: '工商银行',
                    projectName: '多银行联合反洗钱检测模型',
                    dataDescription: '包含100万条去敏化交易记录，涵盖多种洗钱模式',
                    trainingPlan: '使用深度神经网络，计划50轮训练，期望检测率达到98%',
                    expectedPartners: 3,
                    currentPartners: 1,
                    status: 'pending',
                    requestTime: '2024-01-15 15:45'
                }
            ];

            appState.models = [
                { id: 1, name: 'FinNet-Risk', type: 'Risk Assessment', size: '85MB', version: 'v1.3', downloads: 12 },
                { id: 2, name: 'AML-Detector', type: 'Anti Money Laundering', size: '156MB', version: 'v2.0', downloads: 6 },
                { id: 3, name: 'Credit-Score', type: 'Credit Scoring', size: '42MB', version: 'v1.8', downloads: 18 }
            ];
        }

        appState.globalProjects = [
            {
                id: 1,
                name: appState.businessType === 'ai' ? 'CNC机床故障预测联邦训练' : '银行联合风控模型训练',
                participants: appState.businessType === 'ai' ? ['上海一厂', '武汉二厂', '广州四厂'] : ['工商银行', '建设银行'],
                status: 'running',
                accuracy: 91.2,
                round: 67,
                totalRounds: 100
            }
        ];
    }

    function navigateTo(page) {
        appState.currentPage = page;
        updateNavigation();
        renderApp();
    }

    function updateNavigation() {
        const navButtons = ['nav-dashboard', 'nav-clients', 'nav-models'];
        const currentNav = `nav-${appState.currentPage}`;
        
        navButtons.forEach(id => {
            const btn = document.getElementById(id);
            if (id === currentNav) {
                btn.className = 'px-3 py-2 text-sm rounded-md font-medium bg-purple-100 text-purple-700';
            } else {
                btn.className = 'px-3 py-2 text-sm rounded-md font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-100';
            }
        });
    }

    function renderDashboard() {
        const onlineClients = appState.clients.filter(c => c.status === 'online').length;
        const totalClients = appState.clients.length;
        const pendingRequests = appState.trainingRequests.filter(r => r.status === 'pending').length;
        const activeProjects = appState.globalProjects.filter(p => p.status === 'running').length;

        const content = `
            <section>
                <!-- Header -->
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-slate-900">管理员仪表盘</h1>
                    <p class="mt-2 text-slate-600">
                        监控和管理整个联邦学习平台的运行状态，审批训练申请，管理客户端连接。
                    </p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow-md p-6 border border-slate-200">
                        <div class="flex items-center">
                            <div class="p-2 bg-green-100 rounded-lg">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-slate-900">${onlineClients}/${totalClients}</h3>
                                <p class="text-slate-500 text-sm">在线客户端</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6 border border-slate-200">
                        <div class="flex items-center">
                            <div class="p-2 bg-blue-100 rounded-lg">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-slate-900">${activeProjects}</h3>
                                <p class="text-slate-500 text-sm">活跃项目</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6 border border-slate-200">
                        <div class="flex items-center">
                            <div class="p-2 bg-yellow-100 rounded-lg">
                                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-slate-900">${pendingRequests}</h3>
                                <p class="text-slate-500 text-sm">待审批申请</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6 border border-slate-200">
                        <div class="flex items-center">
                            <div class="p-2 bg-purple-100 rounded-lg">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-slate-900">${appState.models.length}</h3>
                                <p class="text-slate-500 text-sm">可用模型</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid lg:grid-cols-2 gap-8 mb-8">
                    <!-- Training Requests -->
                    <div class="bg-white rounded-lg shadow-md border border-slate-200 p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-slate-800">训练申请</h2>
                            <span class="px-2 py-1 text-xs bg-yellow-100 text-yellow-700 rounded-full">${pendingRequests} 待处理</span>
                        </div>
                        <div class="space-y-4">
                            ${appState.trainingRequests.map(request => `
                                <div class="p-4 border border-slate-200 rounded-lg hover:bg-slate-50 cursor-pointer" onclick="viewTrainingRequest(${request.id})">
                                    <div class="flex items-center justify-between mb-2">
                                        <h3 class="font-semibold text-slate-800">${request.projectName}</h3>
                                        <span class="px-2 py-1 text-xs bg-yellow-100 text-yellow-700 rounded">待审批</span>
                                    </div>
                                    <p class="text-sm text-slate-600 mb-2">申请方: ${request.clientName}</p>
                                    <p class="text-sm text-slate-500">期望参与方: ${request.expectedPartners}，当前: ${request.currentPartners}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Global Projects -->
                    <div class="bg-white rounded-lg shadow-md border border-slate-200 p-6">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">全局训练项目</h2>
                        <div class="space-y-4">
                            ${appState.globalProjects.map(project => `
                                <div class="p-4 border border-slate-200 rounded-lg">
                                    <div class="flex items-center justify-between mb-2">
                                        <h3 class="font-semibold text-slate-800">${project.name}</h3>
                                        <span class="px-2 py-1 text-xs bg-green-100 text-green-700 rounded">运行中</span>
                                    </div>
                                    <div class="flex justify-between text-sm text-slate-600 mb-2">
                                        <span>参与方: ${project.participants.join(', ')}</span>
                                        <span>准确率: ${project.accuracy}%</span>
                                    </div>
                                    <div class="flex justify-between text-sm text-slate-500">
                                        <span>轮次: ${project.round}/${project.totalRounds}</span>
                                        <span>进度: ${Math.round(project.round/project.totalRounds*100)}%</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <!-- Client Status -->
                <div class="bg-white rounded-lg shadow-md border border-slate-200 p-6">
                    <h2 class="text-xl font-bold text-slate-800 mb-4">客户端状态</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase">客户端名称</th>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase">地址</th>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase">状态</th>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase">最后在线</th>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase">项目数</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200">
                                ${appState.clients.map(client => `
                                    <tr>
                                        <td class="py-4 px-4 whitespace-nowrap font-medium text-slate-800">${client.name}</td>
                                        <td class="py-4 px-4 whitespace-nowrap text-slate-600 text-sm">${client.address}</td>
                                        <td class="py-4 px-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <span class="w-2.5 h-2.5 rounded-full mr-2 ${client.status === 'online' ? 'bg-green-500' : 'bg-slate-400'}"></span>
                                                <span class="text-slate-700">${client.status === 'online' ? '在线' : '离线'}</span>
                                            </div>
                                        </td>
                                        <td class="py-4 px-4 whitespace-nowrap text-slate-500 text-sm">${client.lastSeen}</td>
                                        <td class="py-4 px-4 whitespace-nowrap text-slate-500">${client.projects}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        `;
        document.getElementById('page-content').innerHTML = content;
    }

    function renderApp() {
        switch(appState.currentPage) {
            case 'dashboard':
                renderDashboard();
                break;
            case 'clients':
                renderClients();
                break;
            case 'models':
                renderModels();
                break;
        }
    }

    function renderClients() {
        const content = `
            <section>
                <div class="flex flex-col md:flex-row justify-between md:items-center mb-6 gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-slate-900">客户端管理</h1>
                        <p class="mt-2 text-slate-600">管理所有连接的客户端，配置访问权限和监控连接状态。</p>
                    </div>
                    <button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg">
                        添加客户端
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow-md border border-slate-200 p-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase">客户端信息</th>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase">连接状态</th>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase">项目参与</th>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase">权限</th>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase">操作</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200">
                                ${appState.clients.map(client => `
                                    <tr>
                                        <td class="py-4 px-4">
                                            <div>
                                                <div class="font-medium text-slate-800">${client.name}</div>
                                                <div class="text-sm text-slate-500">${client.address}</div>
                                            </div>
                                        </td>
                                        <td class="py-4 px-4">
                                            <div class="flex items-center">
                                                <span class="w-2.5 h-2.5 rounded-full mr-2 ${client.status === 'online' ? 'bg-green-500' : 'bg-slate-400'}"></span>
                                                <div>
                                                    <div class="text-slate-700">${client.status === 'online' ? '在线' : '离线'}</div>
                                                    <div class="text-xs text-slate-500">最后在线: ${client.lastSeen}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="py-4 px-4">
                                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded">${client.projects} 个项目</span>
                                        </td>
                                        <td class="py-4 px-4">
                                            <span class="px-2 py-1 text-xs bg-green-100 text-green-700 rounded">正常</span>
                                        </td>
                                        <td class="py-4 px-4">
                                            <div class="flex space-x-2">
                                                <button class="text-blue-600 hover:text-blue-800 text-sm">编辑</button>
                                                <button class="text-red-600 hover:text-red-800 text-sm">删除</button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        `;
        document.getElementById('page-content').innerHTML = content;
    }

    function renderModels() {
        const content = `
            <section>
                <div class="flex flex-col md:flex-row justify-between md:items-center mb-6 gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-slate-900">模型管理</h1>
                        <p class="mt-2 text-slate-600">管理可供下载的模型文件，上传新模型版本。</p>
                    </div>
                    <button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg">
                        上传模型
                    </button>
                </div>

                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${appState.models.map(model => `
                        <div class="bg-white rounded-lg shadow-md border border-slate-200 p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-slate-800">${model.name}</h3>
                                <span class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded">${model.version}</span>
                            </div>
                            <div class="space-y-2 text-sm mb-4">
                                <div class="flex justify-between">
                                    <span class="text-slate-500">类型:</span>
                                    <span class="text-slate-700">${model.type}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-500">大小:</span>
                                    <span class="text-slate-700">${model.size}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-500">下载次数:</span>
                                    <span class="text-slate-700">${model.downloads}</span>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-sm py-2 px-3 rounded">
                                    下载
                                </button>
                                <button class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-800 text-sm py-2 px-3 rounded">
                                    详情
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </section>
        `;
        document.getElementById('page-content').innerHTML = content;
    }

    function viewTrainingRequest(requestId) {
        const request = appState.trainingRequests.find(r => r.id === requestId);
        if (!request) return;

        const modalContent = `
            <div class="flex justify-between items-center pb-3 border-b border-slate-200">
                <h2 class="text-2xl font-bold text-slate-800">训练申请详情</h2>
                <button class="text-slate-400 hover:text-slate-600" onclick="closeModal('training-request-modal')">&times;</button>
            </div>
            <div class="mt-5">
                <div class="space-y-4">
                    <div>
                        <label class="block text-slate-700 text-sm font-bold mb-1">项目名称</label>
                        <p class="text-slate-800">${request.projectName}</p>
                    </div>
                    <div>
                        <label class="block text-slate-700 text-sm font-bold mb-1">申请客户端</label>
                        <p class="text-slate-800">${request.clientName}</p>
                    </div>
                    <div>
                        <label class="block text-slate-700 text-sm font-bold mb-1">数据描述</label>
                        <p class="text-slate-600">${request.dataDescription}</p>
                    </div>
                    <div>
                        <label class="block text-slate-700 text-sm font-bold mb-1">训练计划</label>
                        <p class="text-slate-600">${request.trainingPlan}</p>
                    </div>
                    <div class="flex justify-between">
                        <div>
                            <label class="block text-slate-700 text-sm font-bold mb-1">期望参与方</label>
                            <p class="text-slate-800">${request.expectedPartners}</p>
                        </div>
                        <div>
                            <label class="block text-slate-700 text-sm font-bold mb-1">申请时间</label>
                            <p class="text-slate-500">${request.requestTime}</p>
                        </div>
                    </div>
                </div>
                <div class="mt-8 flex items-center justify-end gap-4">
                    <button class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg" onclick="rejectRequest(${request.id})">
                        拒绝申请
                    </button>
                    <button class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg" onclick="approveRequest(${request.id})">
                        批准申请
                    </button>
                </div>
            </div>
        `;
        
        document.getElementById('modal-content-request').innerHTML = modalContent;
        document.getElementById('training-request-modal').classList.remove('hidden');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.add('hidden');
    }

    function approveRequest(requestId) {
        const requestIndex = appState.trainingRequests.findIndex(r => r.id === requestId);
        if (requestIndex !== -1) {
            appState.trainingRequests.splice(requestIndex, 1);
        }
        closeModal('training-request-modal');
        renderDashboard();
    }

    function rejectRequest(requestId) {
        const requestIndex = appState.trainingRequests.findIndex(r => r.id === requestId);
        if (requestIndex !== -1) {
            appState.trainingRequests.splice(requestIndex, 1);
        }
        closeModal('training-request-modal');
        renderDashboard();
    }

    function toggleAdminMenu() {
        const adminMenu = document.getElementById('adminMenu');
        adminMenu.classList.toggle('hidden');
    }

    function logout() {
        localStorage.removeItem('userData');
        window.location.href = '../index.html';
    }

    window.onload = () => {
        initializeApp();
    };

    // Close admin menu when clicking outside
    document.addEventListener('click', function(event) {
        const adminMenu = document.getElementById('adminMenu');
        const adminButton = adminMenu?.previousElementSibling;
        
        if (adminMenu && !adminMenu.contains(event.target) && event.target !== adminButton) {
            adminMenu.classList.add('hidden');
        }
    });
</script>

</body>
</html>